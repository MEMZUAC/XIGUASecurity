<Page
    x:Class="XIGUASecurity.AppStorePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:XIGUASecurity"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:l="using:WinUI3Localizer"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <StackPanel Grid.Row="0" Margin="64,16,64,12">
            <TextBox x:Name="SearchBox" l:Uids.Uid="AppStore_SearchBox" Width="300" HorizontalAlignment="Left" TextChanged="SearchBox_TextChanged"/>
        </StackPanel>
        
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <ScrollViewer x:Name="AppsScrollViewer" Grid.Column="0" Margin="64,0,0,0" ZoomMode="Disabled" HorizontalScrollMode="Disabled" HorizontalScrollBarVisibility="Disabled" ViewChanged="AppsScrollViewer_ViewChanged">
                <GridView x:Name="AppsGridView" 
                          SelectionMode="None">
                    <GridView.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="8" 
                                    Width="200" 
                                    Height="220"
                                    Padding="16"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <Grid Grid.Row="0" 
                                          Width="32" 
                                          Height="32" 
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Margin="0,0,0,8">
                                        <Image Source="{Binding IconImage}" 
                                               Stretch="UniformToFill"/>
                                        <TextBlock Text="✕" 
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                   Visibility="{Binding IconImage, Converter={StaticResource NullToVisibilityConverter}}"/>
                                    </Grid>
                                    
                                    <ScrollViewer Grid.Row="1" 
                                                  VerticalScrollBarVisibility="Auto"
                                                  HorizontalScrollBarVisibility="Disabled"
                                                  VerticalScrollMode="Auto"
                                                  HorizontalScrollMode="Disabled">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" 
                                                       Style="{StaticResource SubtitleTextBlockStyle}" 
                                                       TextWrapping="Wrap"
                                                       TextTrimming="CharacterEllipsis"
                                                       Margin="0,0,0,8"/>
                                            <TextBlock Text="{Binding Description}" 
                                                       Style="{StaticResource CaptionTextBlockStyle}" 
                                                       TextWrapping="Wrap"
                                                       TextTrimming="WordEllipsis"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>
                                    </ScrollViewer>
                                    
                                    <StackPanel Grid.Row="2" Margin="0,8,0,0">
                                        <TextBlock Text="{Binding Category}" 
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                                                   Margin="0,0,0,8"/>
                                        <Button l:Uids.Uid="AppStore_InstallButton" 
                                                HorizontalAlignment="Stretch"
                                                Command="{Binding InstallCommand}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </GridView.ItemTemplate>
                </GridView>
            </ScrollViewer>
            
            <!-- 分类侧边栏 -->
            <Border Grid.Column="1" 
                    Background="{ThemeResource LayerOnAcrylicFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                    BorderThickness="1,0,0,0"
                    Padding="24,16,24,16"
                    Width="200">
                <StackPanel Spacing="12">
                    <TextBlock l:Uids.Uid="AppStorePage_Categories" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               Margin="0,0,0,8"/>
                    
                    <ListView x:Name="CategoriesListView"
                              SelectionMode="Single"
                              SelectionChanged="CategoriesListView_SelectionChanged"
                              Margin="-12,0,-12,0">
                        <ListViewItem x:Name="AllAppsItem" l:Uids.Uid="AppStorePage_AllApps" Tag="All"/>
                        <ListViewItem x:Name="DevToolsItem" l:Uids.Uid="AppStorePage_DevTools" Tag="开发工具"/>
                        <ListViewItem x:Name="SystemToolsItem" l:Uids.Uid="AppStorePage_SystemTools" Tag="系统工具"/>
                        <ListViewItem x:Name="MultimediaItem" l:Uids.Uid="AppStorePage_Multimedia" Tag="多媒体"/>
                        <ListViewItem x:Name="NetworkToolsItem" l:Uids.Uid="AppStorePage_NetworkTools" Tag="网络工具"/>
                        <ListViewItem x:Name="CommunicationItem" l:Uids.Uid="AppStorePage_Communication" Tag="通讯工具"/>
                        <ListViewItem x:Name="OfficeItem" l:Uids.Uid="AppStorePage_Office" Tag="办公软件"/>
                        <ListViewItem x:Name="DesignItem" l:Uids.Uid="AppStorePage_Design" Tag="设计软件"/>
                    </ListView>
                    
                    <!-- 分隔符 -->
                    <Border Height="1" 
                            Background="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                            Margin="0,8"/>
                    
                    <!-- 页码显示 -->
                    <TextBlock x:Name="PageIndicatorText"
                               l:Uids.Uid="AppStorePage_PageIndicator"
                               HorizontalAlignment="Center"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                </StackPanel>
            </Border>
            
            <!-- 加载进度气泡 -->
            <Border x:Name="LoadingProgressBorder"
                    Grid.Column="0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    Margin="0,0,24,24"
                    Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                    BorderThickness="1"
                    CornerRadius="16"
                    Padding="16,12"
                    Visibility="Collapsed">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <ProgressRing x:Name="LoadingProgressRing" 
                                 Width="20" 
                                 Height="20" 
                                 IsActive="False"/>
                    <TextBlock x:Name="LoadingProgressText" 
                               Text="加载中..." 
                               VerticalAlignment="Center"
                               Style="{StaticResource CaptionTextBlockStyle}"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>